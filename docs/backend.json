{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account in the Jannu Connect application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "username": {
          "type": "string",
          "description": "The user's chosen username."
        },
        "bio": {
          "type": "string",
          "description": "A brief biography or description of the user."
        },
        "location": {
          "type": "string",
          "description": "The user's location (e.g., city, country)."
        },
        "profilePhotoUrl": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "followerCount": {
          "type": "number",
          "description": "The number of users following this user."
        },
        "followingCount": {
          "type": "number",
          "description": "The number of users this user is following."
        },
        "postCount": {
          "type": "number",
          "description": "The number of posts created by this user."
        }
      },
      "required": [
        "id",
        "username"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a post created by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the post.",
          "format": "uuid"
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the User who created the post. (Relationship: User 1:N Post)"
        },
        "contentUrl": {
          "type": "string",
          "description": "URL of the post's content (video or image).",
          "format": "uri"
        },
        "caption": {
          "type": "string",
          "description": "The caption or description associated with the post."
        },
        "timestamp": {
          "type": "string",
          "description": "Date and time when the post was created.",
          "format": "date-time"
        },
        "likeCount": {
          "type": "number",
          "description": "The number of likes on the post."
        },
        "commentCount": {
          "type": "number",
          "description": "The number of comments on the post."
        },
        "shareCount": {
          "type": "number",
          "description": "Number of times the post has been shared."
        },
        "hashtags": {
          "type": "array",
          "description": "A list of hashtag strings associated with the post.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "authorId",
        "contentUrl",
        "timestamp"
      ]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment on a post.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the comment.",
          "format": "uuid"
        },
        "postId": {
          "type": "string",
          "description": "Reference to the Post the comment belongs to. (Relationship: Post 1:N Comment)"
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the User who wrote the comment. (Relationship: User 1:N Comment)"
        },
        "text": {
          "type": "string",
          "description": "The text content of the comment."
        },
        "timestamp": {
          "type": "string",
          "description": "Date and time when the comment was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "postId",
        "authorId",
        "text",
        "timestamp"
      ]
    },
    "Follow": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Follow",
      "description": "Represents a follow relationship between two users.",
      "type": "object",
      "properties": {
        "followerId": {
          "type": "string",
          "description": "The ID of the user who is following."
        },
        "followingId": {
          "type": "string",
          "description": "The ID of the user who is being followed."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The time the follow action occurred."
        }
      },
      "required": ["followerId", "followingId", "timestamp"]
    },
    "Like": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Like",
      "description": "Represents a user liking a post.",
      "type": "object",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The ID of the user who liked the post."
        },
        "postId": {
          "type": "string",
          "description": "The ID of the post that was liked."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The time the like action occurred."
        }
      },
      "required": ["userId", "postId", "timestamp"]
    },
    "Save": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Save",
      "description": "Represents a user saving (collecting) a post.",
      "type": "object",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The ID of the user who saved the post."
        },
        "postId": {
          "type": "string",
          "description": "The ID of the post that was saved."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The time the save action occurred."
        }
      },
      "required": ["userId", "postId", "timestamp"]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the notification.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User the notification is for. (Relationship: User 1:N Notification)"
        },
        "type": {
          "type": "string",
          "description": "Type of notification (e.g., 'like', 'comment', 'follow')."
        },
        "content": {
          "type": "string",
          "description": "The content of the notification message."
        },
        "timestamp": {
          "type": "string",
          "description": "Date and time when the notification was created.",
          "format": "date-time"
        },
        "isRead": {
          "type": "boolean",
          "description": "Indicates whether the notification has been read by the user."
        },
        "relatedPostId": {
          "type": "string",
          "description": "Reference to the Post related to the notification, if applicable. (Relationship: Post 1:N Notification)",
          "format": "uuid"
        },
        "relatedUserId": {
          "type": "string",
          "description": "Reference to the User related to the notification, if applicable. (Relationship: User 1:N Notification)",
          "format": "uuid"
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "content",
        "timestamp",
        "isRead"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/backend/entities/User" },
          "description": "Stores user profiles. Includes denormalized counts for followers, following, and posts.",
          "params": [{ "name": "userId", "description": "The unique identifier of the user." }]
        }
      },
      {
        "path": "/users/{userId}/followers/{followerId}",
        "definition": {
          "entityName": "Follow",
          "schema": { "$ref": "#/backend/entities/Follow" },
          "description": "Subcollection to list who is following the user specified by {userId}.",
          "params": [
            { "name": "userId", "description": "The user being followed." },
            { "name": "followerId", "description": "The user who is following." }
          ]
        }
      },
      {
        "path": "/users/{userId}/following/{followingId}",
        "definition": {
          "entityName": "Follow",
          "schema": { "$ref": "#/backend/entities/Follow" },
          "description": "Subcollection to list who the user specified by {userId} is following.",
          "params": [
            { "name": "userId", "description": "The user who is following." },
            { "name": "followingId", "description": "The user being followed." }
          ]
        }
      },
      {
        "path": "/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": { "$ref": "#/backend/entities/Post" },
          "description": "Main collection for all posts. Data is denormalized for efficient reads.",
          "params": [{ "name": "postId", "description": "The unique identifier of the post." }]
        }
      },
      {
        "path": "/posts/{postId}/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": { "$ref": "#/backend/entities/Comment" },
          "description": "Stores comments for a specific post.",
          "params": [
            { "name": "postId", "description": "The unique identifier of the post." },
            { "name": "commentId", "description": "The unique identifier of the comment." }
          ]
        }
      },
      {
        "path": "/posts/{postId}/likes/{userId}",
        "definition": {
          "entityName": "Like",
          "schema": { "$ref": "#/backend/entities/Like" },
          "description": "Stores likes for a specific post. The document ID is the user's ID.",
          "params": [
            { "name": "postId", "description": "The unique identifier of the post." },
            { "name": "userId", "description": "The user who liked the post." }
          ]
        }
      },
      {
        "path": "/users/{userId}/saved_posts/{postId}",
        "definition": {
          "entityName": "Save",
          "schema": { "$ref": "#/backend/entities/Save" },
          "description": "Stores posts saved (collected) by a specific user.",
          "params": [
            { "name": "userId", "description": "The user who saved the post." },
            { "name": "postId", "description": "The ID of the saved post." }
          ]
        }
      },
      {
        "path": "/users/{userId}/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": { "$ref": "#/backend/entities/Notification" },
          "description": "Stores notifications for a specific user.",
          "params": [
            { "name": "userId", "description": "The unique identifier of the user." },
            { "name": "notificationId", "description": "The unique identifier of the notification." }
          ]
        }
      }
    ],
    "reasoning": "The data model is designed for a scalable social media application, prioritizing efficient queries and clear security rule implementation. It uses a combination of top-level collections for global entities (like `/posts`) and nested subcollections for user-specific data (like `/users/{userId}/followers`). This allows for path-based security rules, which are more performant and secure. \n\n- **User Follow Graph:** Instead of arrays in the User document (which have size limitations), we use `/followers` and `/following` subcollections under each user. This is a standard, scalable pattern. A `Follow` document is created in two places: `/users/{userId}/followers/{followerId}` and `/users/{followerId}/following/{userId}`. This duplication allows easy querying of both 'who follows me?' and 'who am I following?' without complex and slow queries. Counts (`followerCount`, `followingCount`) are denormalized on the `User` document and will be updated via backend functions (triggers) for performance.\n\n- **Likes and Saves:** Similarly, `likes` on a post and `saves` by a user are stored in subcollections (`/posts/{postId}/likes/{userId}` and `/users/{userId}/saved_posts/{postId}`). This avoids unbounded arrays and makes it easy to check if a specific user has liked or saved a post. Counts (`likeCount`) are denormalized on the `Post` document.\n\n- **Authorization Independence:** The structure ensures authorization can be determined from the document path and its contents alone, without needing `get()` calls in security rules. For example, to write to `/users/{userId}/**`, the rule just needs to check `request.auth.uid == userId`."
  }
}