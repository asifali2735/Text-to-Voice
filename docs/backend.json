{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account in the Jannu Connect application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "username": {
          "type": "string",
          "description": "The user's chosen username."
        },
        "bio": {
          "type": "string",
          "description": "A brief biography or description of the user."
        },
        "location": {
          "type": "string",
          "description": "The user's location (e.g., city, country)."
        },
        "profilePhotoUrl": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "followerIds": {
          "type": "array",
          "description": "References to Users who follow this User. (Relationship: User N:N User (Followers))",
          "items": {
            "type": "string"
          }
        },
        "followingIds": {
          "type": "array",
          "description": "References to Users this User is following. (Relationship: User N:N User (Following))",
          "items": {
            "type": "string"
          }
        },
        "likedPostIds": {
          "type": "array",
          "description": "References to Posts liked by this User. (Relationship: User N:N Post (Likes))",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "username"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a post created by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the post.",
          "format": "uuid"
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the User who created the post. (Relationship: User 1:N Post)"
        },
        "contentUrl": {
          "type": "string",
          "description": "URL of the post's content (video or image).",
          "format": "uri"
        },
        "caption": {
          "type": "string",
          "description": "The caption or description associated with the post."
        },
        "timestamp": {
          "type": "string",
          "description": "Date and time when the post was created.",
          "format": "date-time"
        },
        "likeIds": {
          "type": "array",
          "description": "References to Users who liked this Post. (Relationship: User N:N Post (Likes))",
          "items": {
            "type": "string"
          }
        },
        "commentIds": {
          "type": "array",
          "description": "References to Comments on this Post. (Relationship: Post 1:N Comment)",
          "items": {
            "type": "string"
          }
        },
        "saveIds": {
          "type": "array",
          "description": "References to Users who saved this Post. (Relationship: User N:N Post (Saves))",
          "items": {
            "type": "string"
          }
        },
        "shareCount": {
          "type": "number",
          "description": "Number of times the post has been shared."
        },
        "hashtagIds": {
          "type": "array",
          "description": "References to Hashtags associated with this Post. (Relationship: Post N:N Hashtag)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "authorId",
        "contentUrl",
        "timestamp"
      ]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment on a post.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the comment.",
          "format": "uuid"
        },
        "postId": {
          "type": "string",
          "description": "Reference to the Post the comment belongs to. (Relationship: Post 1:N Comment)"
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the User who wrote the comment. (Relationship: User 1:N Comment)"
        },
        "text": {
          "type": "string",
          "description": "The text content of the comment."
        },
        "timestamp": {
          "type": "string",
          "description": "Date and time when the comment was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "postId",
        "authorId",
        "text",
        "timestamp"
      ]
    },
    "Hashtag": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hashtag",
      "type": "object",
      "description": "Represents a hashtag used in posts.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the hashtag.",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "description": "The text of the hashtag (e.g., 'travelphotography')."
        },
        "postIds": {
          "type": "array",
          "description": "References to Posts using this Hashtag. (Relationship: Post N:N Hashtag)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the notification.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User the notification is for. (Relationship: User 1:N Notification)"
        },
        "type": {
          "type": "string",
          "description": "Type of notification (e.g., 'like', 'comment', 'follow')."
        },
        "content": {
          "type": "string",
          "description": "The content of the notification message."
        },
        "timestamp": {
          "type": "string",
          "description": "Date and time when the notification was created.",
          "format": "date-time"
        },
        "isRead": {
          "type": "boolean",
          "description": "Indicates whether the notification has been read by the user."
        },
        "relatedPostId": {
          "type": "string",
          "description": "Reference to the Post related to the notification, if applicable. (Relationship: Post 1:N Notification)",
          "format": "uuid"
        },
        "relatedUserId": {
          "type": "string",
          "description": "Reference to the User related to the notification, if applicable. (Relationship: User 1:N Notification)",
          "format": "uuid"
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "content",
        "timestamp",
        "isRead"
      ]
    },
    "DirectMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DirectMessage",
      "type": "object",
      "description": "Represents a direct message between two users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the direct message.",
          "format": "uuid"
        },
        "senderId": {
          "type": "string",
          "description": "Reference to the User who sent the message. (Relationship: User 1:N DirectMessage (Sender))"
        },
        "recipientId": {
          "type": "string",
          "description": "Reference to the User who received the message. (Relationship: User 1:N DirectMessage (Recipient))"
        },
        "text": {
          "type": "string",
          "description": "The text content of the message."
        },
        "timestamp": {
          "type": "string",
          "description": "Date and time when the message was sent.",
          "format": "date-time"
        },
        "mediaUrl": {
          "type": "string",
          "description": "URL of the media attached to the message (image, video, voice).",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "senderId",
        "recipientId",
        "text",
        "timestamp"
      ]
    },
    "TrendingTopic": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TrendingTopic",
      "type": "object",
      "description": "Represents a trending topic or hashtag.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the trending topic.",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "description": "The name or title of the trending topic."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the trending topic."
        },
        "postCount": {
          "type": "number",
          "description": "The number of posts associated with the trending topic."
        },
        "timestamp": {
          "type": "string",
          "description": "Date and time when the trending topic was identified.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "postCount",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Includes 'followerIds', 'followingIds', and 'likedPostIds' arrays for tracking relationships and preferences.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores posts created by a specific user.  Duplicated from /posts to allow easy querying of a user's own posts.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "postId",
              "description": "The unique identifier of the post."
            }
          ]
        }
      },
      {
        "path": "/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores all posts in the application. Includes denormalized 'authorId' for feed generation. Enables listing all posts.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier of the post."
            }
          ]
        }
      },
      {
        "path": "/posts/{postId}/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": {
            "$ref": "#/backend/entities/Comment"
          },
          "description": "Stores comments for a specific post. Includes denormalized 'authorId' for authorization independence.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier of the post."
            },
            {
              "name": "commentId",
              "description": "The unique identifier of the comment."
            }
          ]
        }
      },
      {
        "path": "/trendingTopics/{trendingTopicId}",
        "definition": {
          "entityName": "TrendingTopic",
          "schema": {
            "$ref": "#/backend/entities/TrendingTopic"
          },
          "description": "Stores trending topics in the application.",
          "params": [
            {
              "name": "trendingTopicId",
              "description": "The unique identifier of the trending topic."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores notifications for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "notificationId",
              "description": "The unique identifier of the notification."
            }
          ]
        }
      },
      {
        "path": "/directMessages/{directMessageId}",
        "definition": {
          "entityName": "DirectMessage",
          "schema": {
            "$ref": "#/backend/entities/DirectMessage"
          },
          "description": "Stores direct messages between users. Each message contains 'senderId' and 'recipientId' for access control.",
          "params": [
            {
              "name": "directMessageId",
              "description": "The unique identifier of the direct message."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure prioritizes authorization independence and efficient data retrieval for the Jannu Connect application. User-generated content (posts, comments) is organized under user-specific collections to simplify ownership-based security rules.  Denormalization is employed to avoid complex `get()` calls in security rules, particularly for features like following and likes.  The structure uses structural segregation, ensuring each collection has a homogeneous security posture. The design explicitly avoids custom claims and relies solely on `request.auth.uid` for authentication, enhancing security and simplifying the rule set.\n\n**Authorization Independence & QAPs:**\n*   **Posts:** Posts are stored in a top-level `/posts` collection, but also duplicated under `/users/{userId}/posts/{postId}` to facilitate easy querying of a user's own posts and simplifies ownership-based security rules. The top level `/posts` collection contains a denormalized `authorId` field to allow listing all posts and enables feed generation via backend functions. This setup satisfies QAPs (rules are not filters) for list operations.\n*   **Comments:** Comments are stored as a subcollection of posts (`/posts/{postId}/comments/{commentId}`). Each comment contains a denormalized `authorId` field copied from the user who created the comment. This allows simpler security rules.\n*   **Likes/Saves:** Likes and Saves are managed through arrays within the `User` and `Post` documents (`likedPostIds`, `saveIds`). While this avoids a separate collection, it's important to limit array sizes to avoid exceeding Firestore document size limits.\n*   **Followers/Following:** The `User` document contains `followerIds` and `followingIds` arrays. Again, it is important to limit array sizes.\n*   **Notifications:** Notifications are stored in a `/users/{userId}/notifications/{notificationId}` collection, ensuring that only the user can access their notifications. This path-based ownership simplifies security rules and enhances privacy.\n*   **Direct Messages:** Direct messages are stored in a top level `/directMessages/{directMessageId}` collection.  Each message stores `senderId` and `recipientId`, which can be used in rules to restrict read access.\n\nThis structure ensures Authorization Independence by denormalizing the necessary data (authorId, members) into each document, eliminating the need for `get()` calls in security rules. This simplifies rule logic and enables atomic operations.\n\n**Trending Topics** are stored in a `/trendingTopics` collection. Since trending topics are application-wide, they are not tied to a specific user.\n"
  }
}